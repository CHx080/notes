ARP协议是一种**<u>仅工作在子网中</u>**的网络层协议，负责通过IP地址以定位MAC地址。用于已知目标主机IP地址但不知到MAC地址的情景。

### ARP报文格式

![image-20250311192856702](https://chx-typora.oss-cn-hangzhou.aliyuncs.com/typora/image-20250311192856702.png)

ARP分为**<u>请求报文和响应报文</u>**，通过报文中的**<u>操作类型</u>**字段指示。

### 子网内通信

考虑主机a向一台处于同一子网的主机b发送数据，已知对方的IP地址，但未知MAC地址。

主机a生成ARP报文，并将源MAC地址和源IP地址字段填入自身信息，把主机b的IP地址填入目的IP地址字段。

**<u>具体目的MAC地址未知，需要填入一个广播MAC地址</u>**

将ARP报文向下交付给链路层，此后子网中的其他所有主机均可收到该ARP报文，只需要与目的IP地址匹配的主机b返回响应报文即可。

### 子网外通信

假设主机a向一台处于不同子网的主机b发送数据，根据IP地址的网络号其就可以判断主机b不再同一子网中。主机a仍会发送ARP请求报文，但是这次不再是请求主机b的MAC地址，而是请求**默认路由器的MAC地址**。在主机a获取到了路由器MAC地址后会将数据传给路由器，由路由器对数据做进一步转发。

### ARP缓存表

操作系统会自动维护一张ARP缓存表，用于存放IP地址和MAC地址的映射关系以避免频繁地发送ARP请求报文，但是这张表中的每一个条目都是有老化时间的，超过时间范围仍未得到更新的条目将被删除。

*arp -a查看arp表*